<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <title>Projections Hub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: 'class' }
  </script>
</head>

<body class="bg-slate-950 text-slate-100">

<div class="aurora-bg" aria-hidden="true"></div>
<div class="aurora-noise" aria-hidden="true"></div>

<div id="transitionOverlay" class="transition-overlay hidden" aria-hidden="true"></div>

<div id="app" class="relative z-10">
  <div class="max-w-7xl mx-auto p-4 min-h-screen flex flex-col">

    <div class="flex flex-wrap gap-3 justify-between items-center mb-4">
      <div class="flex items-center gap-3">
        <div class="brand-badge">
          <span class="brand-dot"></span>
          <span class="font-bold tracking-wide">Projections Hub</span>
        </div>
        <h1 id="pageTitle" class="text-2xl md:text-3xl font-bold">Main Menu</h1>
      </div>

      <div class="flex gap-2 flex-wrap">
        <button id="homeBtn" class="btn btn-soft">Home</button>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-[260px,1fr] gap-4 flex-1">

      <aside id="navAside" class="glass-card p-3 md:p-4 hidden">
        <div class="mb-3">
          <div class="text-xs uppercase tracking-widest opacity-70 mb-2">Navigation</div>
        </div>

        <div class="flex flex-col gap-2">
          <button data-lg="nhl" data-md="proj" class="nav-btn">
            <span class="nav-icon">üèí</span>
            <span class="flex-1 text-left"><div class="font-semibold">NHL Projections</div></span>
            <span class="nav-arrow">‚Üí</span>
          </button>

          <button data-lg="nhl" data-md="lineup" class="nav-btn">
            <span class="nav-icon">üìã</span>
            <span class="flex-1 text-left"><div class="font-semibold">NHL Draft</div></span>
            <span class="nav-arrow">‚Üí</span>
          </button>

          <button data-lg="nhl" data-md="team" class="nav-btn">
            <span class="nav-icon">üèÜ</span>
            <span class="flex-1 text-left"><div class="font-semibold">NHL Best Team</div></span>
            <span class="nav-arrow">‚Üí</span>
          </button>

          <button data-lg="nhl" data-md="best_lineups" class="nav-btn">
            <span class="nav-icon">üî•</span>
            <span class="flex-1 text-left"><div class="font-semibold">NHL Top 10 Lineups</div></span>
            <span class="nav-arrow">‚Üí</span>
          </button>
        </div>
      </aside>

      <main class="glass-card p-3 md:p-4 min-h-[420px]">

        <div id="errorBox" class="hidden mb-4 p-3 rounded-xl border border-red-400/30 bg-red-500/10">
          <div class="font-bold text-red-200">Frontend error</div>
          <div id="errorMsg" class="text-sm opacity-90 mt-1 whitespace-pre-wrap"></div>
        </div>

        <!-- MAIN MENU: FULL WIDTH / FULL HEIGHT 2x2 -->
        <div id="homeView" class="fade-in main-menu-full">
          <div class="main-menu-grid">
            <button data-lg="nhl" data-md="proj" class="nav-btn nav-main-tile">
              <span class="nav-icon">üèí</span>
              <span class="flex-1 text-left">
                <div class="font-semibold text-xl md:text-2xl">NHL Projections</div>
                <div class="text-sm opacity-75 mt-1">Search + sort projections</div>
              </span>
              <span class="nav-arrow">‚Üí</span>
            </button>

            <button data-lg="nhl" data-md="lineup" class="nav-btn nav-main-tile">
              <span class="nav-icon">üìã</span>
              <span class="flex-1 text-left">
                <div class="font-semibold text-xl md:text-2xl">NHL Draft</div>
                <div class="text-sm opacity-75 mt-1">Optimal lineup for today</div>
              </span>
              <span class="nav-arrow">‚Üí</span>
            </button>

            <button data-lg="nhl" data-md="team" class="nav-btn nav-main-tile">
              <span class="nav-icon">üèÜ</span>
              <span class="flex-1 text-left">
                <div class="font-semibold text-xl md:text-2xl">NHL Best Team</div>
                <div class="text-sm opacity-75 mt-1">Ranked team stacks</div>
              </span>
              <span class="nav-arrow">‚Üí</span>
            </button>

            <button data-lg="nhl" data-md="best_lineups" class="nav-btn nav-main-tile">
              <span class="nav-icon">üî•</span>
              <span class="flex-1 text-left">
                <div class="font-semibold text-xl md:text-2xl">NHL Top 10 Lineups</div>
                <div class="text-sm opacity-75 mt-1">Best lineups list</div>
              </span>
              <span class="nav-arrow">‚Üí</span>
            </button>
          </div>
        </div>

        <div id="searchWrap" class="mb-4 hidden fade-in">
          <input id="playerSearch" placeholder="Search player"
            class="px-3 py-2 rounded border w-full max-w-sm bg-white/5 backdrop-blur-md border-white/10 focus:outline-none focus:ring-2 focus:ring-emerald-200/20">
        </div>

        <div id="loading" class="hidden text-center py-10 text-lg fade-in">
          <div class="spinner mx-auto mb-3"></div>
          Loading data...
        </div>

        <div id="projectionView" class="overflow-x-auto rounded-lg hidden fade-in"></div>

        <div id="lineupView" class="hidden mt-2 fade-in">
          <h2 class="text-2xl font-bold mb-2">Optimal Lineup</h2>
          <div class="table-wrap">
            <table class="w-full rounded-lg overflow-hidden">
              <thead class="bg-white/10">
                <tr>
                  <th class="p-2 text-left">Player</th>
                  <th class="p-2 text-right">Proj</th>
                  <th class="p-2 text-right">Boost</th>
                  <th class="p-2 text-right">Mult</th>
                  <th class="p-2 text-right">Score</th>
                </tr>
              </thead>
              <tbody id="lineupBody" class="bg-white/5"></tbody>
              <tfoot>
                <tr class="font-bold border-t border-white/10">
                  <td class="p-2">Total</td>
                  <td colspan="4" id="lineupTotal" class="p-2 text-right"></td>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>

        <div id="teamView" class="hidden mt-2 fade-in">
          <div class="flex flex-wrap items-end justify-between gap-2 mb-3">
            <div>
              <h2 class="text-2xl font-bold">Top Team Stacks</h2>
            </div>
            <div class="text-xs opacity-70">Highest teams at the top</div>
          </div>
          <div id="teamRankList" class="space-y-3"></div>
        </div>

        <div id="bestLineupsView" class="hidden mt-2 fade-in">
          <div class="flex flex-wrap items-end justify-between gap-2 mb-3">
            <div>
              <h2 class="text-2xl font-bold">Top 10 Lineups</h2>
              <div class="text-xs opacity-70 mt-1">From <span class="font-semibold">NHL_BEST_LINEUPS</span></div>
            </div>
            <div class="text-xs opacity-70">Showing 10 lineups</div>
          </div>

          <div id="bestLineupsList" class="space-y-4"></div>
        </div>

      </main>
    </div>

  </div>
</div>

<script>
const BASE_URL =
  "https://script.google.com/macros/s/AKfycbyFOaZsa1uC5KJj9eWDPdaZA2UxGkc9CoScwMcUxfjNXWdcHe29KxsYu485sVwYie_d/exec";

const el = {
  pageTitle: document.getElementById("pageTitle"),
  homeBtn: document.getElementById("homeBtn"),
  navAside: document.getElementById("navAside"),

  errorBox: document.getElementById("errorBox"),
  errorMsg: document.getElementById("errorMsg"),

  homeView: document.getElementById("homeView"),
  searchWrap: document.getElementById("searchWrap"),
  playerSearch: document.getElementById("playerSearch"),
  loading: document.getElementById("loading"),

  projectionView: document.getElementById("projectionView"),
  lineupView: document.getElementById("lineupView"),
  lineupBody: document.getElementById("lineupBody"),
  lineupTotal: document.getElementById("lineupTotal"),

  teamView: document.getElementById("teamView"),
  teamRankList: document.getElementById("teamRankList"),

  bestLineupsView: document.getElementById("bestLineupsView"),
  bestLineupsList: document.getElementById("bestLineupsList"),
};

let league = "nhl";
let mode = "home";
let allData = [];
let bestLineups = [];

let sortKey = null;
let sortDir = "desc";

function clearError() {
  el.errorBox.classList.add("hidden");
  el.errorMsg.textContent = "";
}
function showError(msg) {
  el.errorBox.classList.remove("hidden");
  el.errorMsg.textContent = msg;
}

function startTransition() {
  const o = document.getElementById("transitionOverlay");
  o.classList.remove("hidden");
  document.documentElement.classList.add("is-transitioning");
}
function endTransition() {
  const o = document.getElementById("transitionOverlay");
  o.classList.add("out");
  setTimeout(() => {
    o.classList.add("hidden");
    o.classList.remove("out");
    document.documentElement.classList.remove("is-transitioning");
  }, 240);
}

function setSidebarVisible(isVisible) {
  el.navAside.classList.toggle("hidden", !isVisible);
}
function setViewsVisible({ home=false, proj=false, lineup=false, team=false, bestLineupsPage=false, search=false }) {
  el.homeView.classList.toggle("hidden", !home);
  el.projectionView.classList.toggle("hidden", !proj);
  el.lineupView.classList.toggle("hidden", !lineup);
  el.teamView.classList.toggle("hidden", !team);
  el.bestLineupsView.classList.toggle("hidden", !bestLineupsPage);
  el.searchWrap.classList.toggle("hidden", !search);
}

async function fetchJsonWithDebug(url) {
  const res = await fetch(url, { cache: "no-store" });
  const contentType = (res.headers.get("content-type") || "").toLowerCase();
  const text = await res.text();

  if (!res.ok) {
    throw new Error(`Fetch failed: ${res.status} ${res.statusText}\nURL: ${url}\n\nBody:\n${text.slice(0, 600)}`);
  }

  if (!contentType.includes("application/json")) {
    try {
      return JSON.parse(text);
    } catch {
      throw new Error(`Non-JSON response (content-type: ${contentType || "unknown"})\nURL: ${url}\n\nBody:\n${text.slice(0, 600)}`);
    }
  }

  try {
    return JSON.parse(text);
  } catch {
    throw new Error(`JSON parse error\nURL: ${url}\n\nBody:\n${text.slice(0, 600)}`);
  }
}

function unwrapToArray(x) {
  if (Array.isArray(x)) return x;
  if (x && Array.isArray(x.data)) return x.data;
  if (x && Array.isArray(x.rows)) return x.rows;
  if (x && Array.isArray(x.items)) return x.items;
  return [];
}

async function goHome() {
  startTransition();
  clearError();

  league = "nhl";
  mode = "home";
  el.pageTitle.textContent = "Main Menu";

  setSidebarVisible(false);
  setViewsVisible({ home:true });

  el.loading.classList.add("hidden");
  endTransition();
}

async function loadLeague(lg, md) {
  lg = "nhl";

  startTransition();
  clearError();

  league = lg;
  mode = md;

  sortKey = null;
  sortDir = "desc";

  setSidebarVisible(true);

  el.pageTitle.textContent =
    "NHL" + (
      md === "proj" ? " Projections" :
      md === "lineup" ? " Today‚Äôs Draft" :
      md === "team" ? " Best Team" :
      md === "best_lineups" ? " Top 10 Lineups" :
      ""
    );

  setViewsVisible({ home:false, proj:false, lineup:false, team:false, bestLineupsPage:false, search:false });

  const showProj = (md === "proj");
  const showLineup = (md === "lineup");
  const showTeam = (md === "team");
  const showBestLineups = (md === "best_lineups");

  setViewsVisible({
    proj: showProj,
    lineup: showLineup,
    team: showTeam,
    bestLineupsPage: showBestLineups,
    search: showProj
  });

  el.loading.classList.remove("hidden");

  try {
    if (md === "best_lineups") {
      const url = `${BASE_URL}?league=nhl&sheet=NHL_BEST_LINEUPS`;
      const json = await fetchJsonWithDebug(url);
      bestLineups = unwrapToArray(json);
    } else {
      const url = `${BASE_URL}?league=nhl`;
      const json = await fetchJsonWithDebug(url);
      allData = unwrapToArray(json);
    }

    if (md === "proj") renderTable();
    else if (md === "lineup") computeLineup();
    else if (md === "team") computeRankedTeamStacks();
    else if (md === "best_lineups") renderBestLineups();
  } catch (e) {
    console.error(e);
    showError(String(e.message || e));
  } finally {
    el.loading.classList.add("hidden");
    endTransition();
  }
}

/* Keep your real implementations */
function renderTable(){ /* your existing implementation */ }
function computeLineup(){ /* your existing implementation */ }
function computeRankedTeamStacks(){ /* your existing implementation */ }
function renderBestLineups(){ /* your existing implementation */ }

/* EVENTS */
el.homeBtn.addEventListener("click", goHome);

document.addEventListener("click", (e) => {
  const btn = e.target.closest("button[data-lg][data-md]");
  if (!btn) return;
  const md = btn.getAttribute("data-md");
  loadLeague("nhl", md);
});

el.playerSearch.addEventListener("input", renderTable);

goHome();
</script>

<style>
.is-transitioning #app{
  filter: blur(12px) saturate(1.15);
  transform: translateZ(0);
}

.transition-overlay{
  position: fixed;
  inset: 0;
  z-index: 9999;
  pointer-events: none;
  opacity: 0;
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  transition: opacity .18s ease;
}
.transition-overlay.out{
  opacity: 0;
  transition: opacity .22s ease;
}
.transition-overlay::before{
  content:"";
  position:absolute;
  inset:0;
  background: rgba(2,6,23,.35);
}
.is-transitioning #transitionOverlay{
  opacity: 1;
}

.btn{
  padding:.55rem 1rem;border-radius:.6rem;
  background: rgba(255,255,255,.06);
  border: 1px solid rgba(255,255,255,.10);
  backdrop-filter: blur(10px);-webkit-backdrop-filter: blur(10px);
  transition: transform .18s ease, box-shadow .18s ease, background .18s ease;
}
.btn:hover{ transform: translateY(-2px); box-shadow: 0 16px 40px rgba(0,0,0,.55); background: rgba(255,255,255,.08); }
.btn:active{ transform: translateY(0); }
.btn-soft{ background: rgba(255,255,255,.05); }

.glass-card{
  border-radius: 1rem;
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(2,6,23,.35);
  box-shadow: 0 18px 55px rgba(0,0,0,.55);
  backdrop-filter: blur(14px);-webkit-backdrop-filter: blur(14px);
}

.nav-btn{
  display:flex;align-items:center;gap:.75rem;
  padding: 1.2rem 1.2rem;
  border-radius: 1.1rem;
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.05);
  transition: transform .18s ease, box-shadow .18s ease, background .18s ease;
}
.nav-btn:hover{ transform: translateY(-2px); background: rgba(255,255,255,.08); box-shadow: 0 16px 38px rgba(0,0,0,.55); }
.nav-icon{
  width: 44px;height: 44px;display:grid;place-items:center;
  border-radius: 1rem;background: rgba(255,255,255,.06);
  border: 1px solid rgba(255,255,255,.10);
}
.nav-arrow{ opacity:.75; transition: transform .18s ease, opacity .18s ease; }
.nav-btn:hover .nav-arrow{ transform: translateX(3px); opacity: 1; }

/* ‚úÖ FULL SCREEN MAIN MENU LAYOUT */
.main-menu-full{
  width: 100%;
  height: calc(100vh - 190px); /* subtract header area */
  min-height: 520px;
  display: flex;
  align-items: stretch;
}
.main-menu-grid{
  width: 100%;
  height: 100%;
  display: grid;
  gap: 1rem;
  grid-template-columns: 1fr;
}
@media (min-width: 640px){
  .main-menu-grid{
    grid-template-columns: 1fr 1fr; /* 2x2 */
  }
}

/* ‚úÖ Each tile fills its grid cell completely */
.nav-main-tile{
  width: 100%;
  height: 100%;
  justify-content: space-between;
  align-items: flex-start;
}

.aurora-bg{
  position: fixed; inset: -30%; z-index: 0;
  background:
    radial-gradient(circle at 12% 22%, rgba(16,185,129,.42), transparent 58%),
    radial-gradient(circle at 86% 28%, rgba(34,211,238,.40), transparent 58%),
    radial-gradient(circle at 50% 86%, rgba(16,185,129,.34), transparent 62%),
    radial-gradient(circle at 28% 72%, rgba(34,211,238,.28), transparent 62%),
    radial-gradient(circle at 70% 68%, rgba(16,185,129,.24), transparent 64%);
  filter: blur(22px) saturate(1.35);
  animation: auroraMove 12s ease-in-out infinite;
}
.aurora-noise{
  position: fixed; inset: 0; z-index: 1;
  pointer-events: none; opacity: .08;
  background-image:
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='320' height='320'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='320' height='320' filter='url(%23n)' opacity='.6'/%3E%3C/svg%3E");
  mix-blend-mode: overlay;
}
@keyframes auroraMove{
  0%{ transform: translate3d(-2%, -1%, 0) scale(1.02); }
  50%{ transform: translate3d(2%, 1%, 0) scale(1.05); }
  100%{ transform: translate3d(-2%, -1%, 0) scale(1.02); }
}

.brand-badge{
  display:flex;align-items:center;gap:.5rem;
  padding:.4rem .7rem;border-radius: 999px;
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.05);
  backdrop-filter: blur(12px);
}
.brand-dot{
  width:10px;height:10px;border-radius:999px;
  background: linear-gradient(90deg, rgba(16,185,129,1), rgba(34,211,238,1));
  box-shadow: 0 0 18px rgba(34,211,238,.25);
  animation: pulseDot 2.2s ease-in-out infinite;
}
@keyframes pulseDot{
  0%,100%{ transform: scale(1); opacity: .9; }
  50%{ transform: scale(1.18); opacity: 1; }
}
</style>

</body>
</html>
